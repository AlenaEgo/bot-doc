# 5. **Описание параметров**

## 5.1. **Параметры транзакционных подключений**

___

При добавлении нового транзакционного подключения необходимо заполнить ряд полей. Количество и тип полей зависят от биржи/рынка, к которым выполняется подключение. Далее дано описание полей для поддерживаемых бирж и рынков.

### **5.1.1. Московская биржа: фьючерсы и опционы**

В настоящее время для подключения к рынку фьючерсов и опционов Московской биржи используются только подключения по протоколу TWIME, проколы FIX и Plaza II не поддерживаются.

#### **5.1.1.1 Name**

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке транзакционных подключений ему было проще ориентироваться. Разрешенные символы: `_ a-z A-Z 0-9`

#### **5.1.1.2 Conn type**

Тип подключения. Поддерживаются варианты TWIME и TWIME_on_moves. Второй тип подключения является экспериментальным. В нём в одно подключение по факту добавляется несколько подключений. Заявки выставляются заранее по краям стакана. А при появлении приказа на выставление заявки, заранее выставленные заявки переставляются на заданную цену с заданным объёмом. Не используйте режим TWIME_on_moves, если вы не осведомлены о работе подключения в данном режиме. Для получения дополнительной информации о данном режиме вы можете обратиться в поддержку.

#### **5.1.1.3. TWIME server**

Адрес TWIME-сервера биржи, к которому будет выполняться подключение.

#### **5.1.1.4. TWIME credentials**

Credentials предоставляются брокером.

#### **5.1.1.5. Number of movable orders**

Количество заявок, которые робот будет держать по краям стакана, чтобы при необходимости использовать для переставлений. Этот параметр задает количество заявок на инструмент. В случае, если все заявки в данный момент использованы, то робот будет бросать по алгоритму Round robin.

#### **5.1.1.6. Min steps to pull**

Отступ от цен, на которых стоят заявки для перемещения по краям стакана, при достижении которого лучшей ценой, эти заявки снимаются чтобы избежать их исполнения. Если все же они исполнятся, то сделки по ним не будут учтены в алгоритме, и произойдет расхождение позиции в роботе и на бирже.

#### **5.1.1.7. Trading account(s)**

Торговый счёт, его можно найти в привязанном к счёту терминале или запросить у брокера.

![](./00-img/5-1-1-7.png)

#### **5.1.1.8. TWIME comment**

Уникальный идентификатор для всех заявок для данного подключения, задаётся пользователем для собственного удобства (если не используется, оставляйте пустым).

#### **5.1.1.9. Round robin**

Включение и выключение режима `Round robin` для данного подключения.
Подробнее о Round robin - [здесь нужна ссылка 5-3-24]().

#### **5.1.1.10. Max trans**

Лимит транзакций в секунду. В анкете у вас указана производительность логина в единицах производительности, где 1 единица равна 30 транзакциям в секунду.

#### **5.1.1.11. Reserved trans**

Количество зарезервированных транзакций в секунду для заявок на удаление. Использование данного параметра уменьшает количество выставлений заявки, доступных за одну секунду, но позволяет увеличить вероятность того, что робот успеет отдернуть (снять) заявку при уходе цен.

#### **5.1.1.12. Move order**

Разрешить или запретить использование приказов на переставление (изменение) заявки для данного подключения.

#### **5.1.1.13. Bind IP**

IP-адрес, с которого будет проходить подключение к бирже. Если у вас указан IP в договоре, то указывайте. Если не указан, оставьте значение `Automatic`.

### **5.1.2. Московская биржа: фондовый и валютный рынки**

В настоящее время для подключения к фондовому и валютному рынкам Московской биржи используются только подключения по протоколу FIX, другие протоколы не поддерживаются.

#### **5.1.2.1. Name**

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке транзакционных подключений ему было проще ориентироваться. Разрешенные символы: `_ a-z A-Z 0-9`

#### **5.1.2.2. Conn type**

Тип подключения. Поддерживаются варианты FIX и FIX_on_moves. Второй тип подключения является экспериментальным. нём в одно подключение по факту добавляется несколько подключений. Заявки выставляются заранее по краям стакана. А при появлении приказа на выставление заявки, заранее выставленные заявки переставляются на заданную цену с заданным объёмом. Не используйте режим TWIME_on_moves, если вы не осведомлены о работе подключения в данном режиме. Для получения дополнительной информации о данном режиме вы можете обратиться в поддержку.

#### **5.1.2.3. Server**

Адрес FIX-сервера биржи, к которому будет выполняться подключение.

#### **5.1.2.4. SenderCompID**

Значение данного параметра предоставляется брокером.

#### **5.1.2.5. Password**

Пароль для данного FIX-подключения. Если не меняли, то используйте стандартный, указанный в поле для ввода.

#### **5.1.2.6. Trading account(s)**

Торговый счёт, предоставляется брокером, так же можно посмотреть в терминале.

![](./00-img/5-1-2-6.png)

#### **5.1.2.7. Round robin**

Включение и выключение режима `Round robin` для данного подключения.
Подробнее о Round robin - [здесь нужна ссылка 5-3-24]().

#### **5.1.2.8. Client code**

Код клиента можно посмотреть в привязанном к счёту терминале (нажать F7 и открыть таблицу "Позиции по деньгам") или запросить у брокера.

![](./00-img/5-1-2-8.png)

#### **5.1.2.9. Firm level account**

Указание на то, что ваш аккаунт является аккаунтом уровня фирмы. Неверное задание данного параметра приводит к ошибкам снятия и переставления заявок.

#### **5.1.2.10. Number of movable orders**

Количество заявок, которые робот будет держать по краям стакана, чтобы при необходимости использовать для переставлений. Этот параметр задает количество заявок на инструмент. В случае, если все заявки в данный момент использованы, то робот будет бросать по алгоритму Round robin.

#### **5.1.2.11. Min steps to pull**

Отступ от цен, на которых стоят заявки для перемещения по краям стакана, при достижении которого лучшей ценой, эти заявки снимаются чтобы избежать их исполнения. Если все же они исполнятся, то сделки по ним не будут учтены в алгоритме, и произойдет расхождение позиции в роботе и на бирже.

#### **5.1.2.12. Bind IP**

IP-адрес, с которого будет проходить подключение к бирже. Если у вас указан IP в договоре, то указывайте. Если не указан, оставьте значение `Automatic`.

### **5.1.3. Санкт-Петербургская биржа**

#### **5.1.3.1. Name**

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке транзакционных подключений ему было проще ориентироваться. Разрешенные символы: `_ a-z A-Z 0-9`

#### **5.1.3.2. Server**

Адреса для подключения к серверу биржи.

#### **5.1.3.3. Login**

Логин для доступа к бирже, берется из договора с биржей.

#### **5.1.3.4. Password**

Пароль для доступа к бирже, берется из договора с биржей.

#### **5.1.3.5. Memder ID**

Идентификатор участника торгов, берется из договора с биржей.

#### **5.1.3.6. Trading account(s)**

Идентификатор торгово-клирингового счёта участника, берется у брокера. Можете добавить несколько через запятую.

#### **5.1.3.7. Client ID**

Идентификатор клиентского кода, берется из договора с биржей.

#### **5.1.3.8. Bind IP**

IP-адрес, с которого будет проходить подключение к бирже. Если у вас указан IP в договоре, то указывайте. Если не указан, оставьте значение `Automatic`.

### **5.1.4. Криптовалютные биржи**

На большинстве криптовалютных бирж для подключения достаточно одной или нескольких пар ключей (API Keys). Пара ключей - это публичный и секретный ключи. На разных биржах они могут называться немного по-разному. Сгенерировать пару ключей обычно можно самостоятельно на сайте биржи. Раздел управления ключами чаще всего можно найти в Настройки - Безопасность - API. На некоторых биржах у пар ключей есть понятие разрешений/привилегий, при создании ключей не забывайте указывать ключам разрешение на выполнение торговых операций.

#### **5.1.4.1. Name**

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке подключений ему было проще ориентироваться.

#### **5.1.4.2. API Key/API/ID/Access Key/Public Key/Key**

Публичный API-ключ для доступа к бирже, берется на бирже. Находится чаще всего в Настройки - Безопасность - API.

#### **5.1.4.3. API key secret/Secret/Access Secret/Private Key/Secret Key**

Секретный API-ключ для доступа к бирже, берется на бирже. Находится чаще всего в Настройки - Безопасность - API.

#### **5.1.4.4. Bind IP**

IP-адрес, с которого будет проходить подключение к бирже. Можете оставить Automatic или, при необходимости, установите определенный IP для подключения.

#### **5.1.4.5. Margin account**

Указатель на то, что ваш аккаунт является маржинальным. Применяется не на всех криптобиржах.

#### **5.1.4.6. Passphrase**

Фраза-пароль для доступа к бирже, применяется только для Kukoin.

#### **5.1.4.7. Flood timeout**

В данном параметре указывается время, которое мы будем выжидать и не выставлять заявки после получения ошибки REASON_FLOOD (только для биржи Cex.io).

#### **5.1.4.8. User ID**

Это ID пользователя (только для биржи Cex.io).

#### **5.1.4.9. COD**

Cancel on disconnect - включить механизм снятия заявок при разрыве связи (только для биржи Cex.io).

#### **5.1.4.10. Create fast data connection**

Поставьте данный флаг, если хотите создать быстрое маркетдата подключение с той же парой ключей (только для биржи Deribit).

#### **5.1.4.11. Subaccount**

В данном поле указывается имя субаккаунта. Если суббакаунты не используются, то поле нужно оставить пустым.

#### **5.1.4.12. Single ADDING order**

Для каждой бумаги разрешить только одну заявку в статусе ADDING, при попытке выставления еще одной заявки возвращать ошибку выставления. (Только для биржи Cex.io).

## **5.2. Параметры портфеля**

___

Далее дано описание параметров портфеля. Все параметры являются редактируемыми, если прямо не указано иное. Описания некоторых параметров портфеля объединены в группы для удобства восприятия.

### **5.2.1. Name**

`Name` - имя портфеля. В данном поле можно использовать латинские буквы и цифры, максимум 30 символов. Имя не редактируется. Для изменения имени можете выключить торговлю, склонировать портфель, изменить имя склонированного портфеля и удалить предыдущий портфель.

### **5.2.2. re_sell/re_buy**

`re_sell/re_buy` - разрешена продажа/покупка (при взведении флага включает робот на продажу/покупку).

Важно: при снятии галок `re_sell` и `re_buy` происходит сброс счетчика ошибок робота.

### **5.2.3. Type**

`Type` - тип торгового алгоритма портфеля:

* `Arbitrage` - обычная арбитражная торговля с использованием всех заданных параметров. Сначала выставляется заявка по [Is first на 5.3.11.]() инструменту, при её сведении в сделку выставляются заявки по остальным инструментам портфеля.

* `Option hedge` - режим хеджирования, `count` всех инструментов кроме [Is first на 5.3.11.]() равен единице, `count` для [Is first на 5.3.11.]() инструмента задается как delta - "грек", вычисляемый с использованием модели Блека-Шоулза, [Is first на 5.3.11.]() инструмент в таком режиме должен быть опционом.

* `Test algo` - тестовый режим для проверки скорости работы "движков" подключений на получение рыночных данных и на выставление заявок, использовать данный режим без обращения к технической поддержке НЕ рекомендуется, прибыли он НЕ приносит.

* `TP algo` - режим работы с выставлением "take profit" заявки по главному инструменту. По главному инструменту держится только одна TP заявка, после прохождения не TP заявок в сделку, заявка TP снимается и выставляется новым объёмом. Заявки по второй ноге при этом не выставляются.

* TP algo 2 - режим работы с выставлением "take profit" заявки по главному инструменту. После каждой сделки по не TP заявке, выставляется новая TP заявка. У выставленной заявки есть `Timer` и `SL`. Заявки по второй ноге выставляются так же, как и в режиме `Arbitrage`.<br>

**Важно**: Если включен `hedge sec`, то каждые `hedge sec` секунд если позиция по главному инструменту портфеля ненулевая и нет выставляющихся или стоящих заявок, сводящих эту позицию к нулю, будет выставляться заявка, сводящая позицию к нулю; описанное выше распространяется и на позиции, открытые кликером; закрытие по hedge sec возможно только после того, как были сделки по главной бумаге по алгоритму (не по кликеру). Пока сделок не было, нет цен от которых откладывать тейк.

### **5.2.4. Type trade**

`Type trade` - тип торговли, используется при расчете цен [Sell/Buy 5.2.39](), [Price_s/Price_b 5.2.40]():

* `Price` - режим торговли с расчетом вышеперечисленных цен по ценам инструментов на покупку и продажу.

* IV - режим торговли с расчетом вышеперечисленных цен по "implied volatility" инструментов с использованием модели Блека-Шоулза.

### **5.2.5. Type price**

`Type price` - тип определения цены инструмента:

* `Bid/offer`- использовать лучшую цену на покупку и лучшую цену на продажу.

* `Orderbook` - параметр позволяет искать цену в стакане, таким образом, чтобы набрать необходимый объем. Цены на покупку и продажу набираются среди цен в стакане, начиная от лучшей цены в нужном направлении и далее вглубь стакана. Поиск необходимого объема происходит с помощью данной формулы:

![](./00-img/5-2-5.jpg)

* `Orderbook+filter` - аналогично Orderbook, но вычитать из набираемого объема цены своих заявок (если на соответствующих ценах присутствуют свои заявки).

### **5.2.6. Quote**

`Quote` - параметр позволяет котировать инструмент. Если включен, то заявка всегда держится в стакане, если выключено, то заявка на продажу выставляется когда `Sell ≥ Lim_Sell`, а заявка на покупку выставляется когда `Buy ≤ Lim_Buy`.

Видео объясняющее работу данного параметра:

<iframe width="560" height="315" src="https://www.youtube.com/embed/CfY5ZeS8aJM" title="Описание параметра Quote" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

### **5.2.7. Order ID**

`Order ID` - идентификатор всех заявок портфеля, так же определяет приоритет вызова торгового алгоритма портфеля.

_Пример_:<br>
Пусть есть несколько портфелей и во всех этих портфелях есть один и тот же инструмент. При изменении цены или объема лучшей цены на покупку или продажу по данному инструменту вызывается алгоритм торговли по всем портфелям, в которых этот инструмент присутствует. Торговый алгоритм портфелей будет вызываться в порядке возрастания Order ID, т.е. самым первым вызовется торговый алгоритм портфеля с Order ID = a, а самым последним с Order ID = z. При совпадении Order ID у разных портфелей порядок вызова торгового алгоритма портфелей НЕ определен и будет произвольным.

### **5.2.8. Hedge (sec)**

`Hedge (sec)` - интервал времени в секундах по прошествии которого автоматически хеджировать незахеджированную позицию в случаях, когда заявка по второй ноге не выставилась по алгоритму (случаи связанные с техническими проблемами на самой бирже, ограничениями по рейтлимиту и другими не рыночными ситуациями). Если задать значение "-1", то проверка по таймеру на незахеджированность не осуществляется.

**Неочевидный момент:**<br>
Если позиция, с учетом прохождения текущих активных заявок, расходится больше чем на значение [Overlay 5.2.17]() (активные заявки могут быть), то подравняется позиция не трогая текущих активных заявок. Если подравнивающая заявка выставилась, то скинется счетчик ошибок для данной бумаги. Расхождение считается отдельно для каждого из инструментов второй ноги. Выравнивание также осуществляется по каждому из инструментов второй ноги отдельно. В один момент времени на каждом из инструментов второй ноги может висеть не более одной выравнивающей заявки. Выравнивающая заявка, в случае если она не прошла в сделку, переставляется раз в секунду (поведение совпадает со стоп лосс заявкой).

### **5.2.9. Simply first**

`Symply first` - если параметр включен, то когда цены [Price_s/Price_b 5.2.40]() попадают в спред или на противоположную сторону стакана, то они всегда будут выставляться не глубже, чем на один шаг цены в спред:

![](./00-img/5-2-9.jpg)

где `bid`, `offer`, `step` - это бид, оффер и шаг цены по [Is first 5.3.11]() бумаге, нижний индекс "0" означает текущее значение параметра, нижний индекс "1" означает новое значение параметра.<br>
Если у [Is first 5.3.11]() бумаги взведен флаг `Maker` и текущий спред в стакане равен одному шагу цены, то заявка на продажу будет выставлена по цене offer, а на покупку по цене bid (в противном случае заявка просто не смогла бы выставиться и "спамила" бы биржу).

**Важно**: если наша заявка становится бидом или оффером, при этом является единственной заявкой на данном ценовом уровне и цена следующего уровня стакана отличается от цены нашей заявки более чем на один шаг цены, то заявка снимается и далее выставляется по ценам, описанным выше.

### **5.2.10. Equal prices**

Если галка не стоит, то цена второй ноги определяется исходя из цен, которые дали сигнал. Если галка стоит, то заявка по второй ноге будет выставлена по такой цене, чтобы `Sell = Lim_Sell` и `Buy = Lim_Buy` (работает только для портфелей с двумя бумагами).<br>
Таким образом цены в заявках будут строго соответствовать `Lim_sell`, даже если в моменте были лучшие цены.
Включение параметра способствует меньшему числу проскальзываний по второй ноге, но и уменьшает количество положительных проскальзываний (когда купили по цене лучшей, чем хотели).

_Пример_: в первой ноге стоит цена 100, в второй цена 95. Мы хотим купить в первой ноге по 100, если в второй тоже будет цена сто, т.е. раздвижка будет ноль. В моменте во второй ноге резко рынок дергается вверх и достигает 110.
Если галка стоит, то мы купим первую ногу по сто, и попытаемся продать вторую по 100 (т.к. нас устраивала раздвижка ноль).
Если галка НЕ стоит, то мы кинем на цену которые дали сигнал к сделке , т.е. первую также купим по сто, вторую попытаемся продать по 110.

Формула для цены второй ноги для покупки и продажи:

![](./00-img/5-2-10.jpg)

± - зависит от того, какой `On buy` на 2-й ноге `Buy`, тогда "+" или `Sell`.

### **5.2.11. Volumes**

`Volumes` - группа параметров отвечающих за объем выставляемых заявок. Группу можно разделить на две пары параметров: [v_in_left/v_in_right 5.2.11.2]() и [v_out_left/v_out_right 5.2.11.3](), а так же параметры [Virt_0_pos 5.2.11.4]() и [n_perc_fill 5.2.11.5]().

#### **5.2.11.1. v_min/v_max**

`v_min/v_max` - минимальная/максимальная разрешенная позиция для главного инструмента портфеля. Измеряется в лотах.

#### **5.2.11.2. v_in_left/v_in_right**

`v_in_left/v_in_right` - отвечает за минимальный/максимальный разрешенный объем для однократного входа в позицию (в штуках портфелей);<br>
Если тип определения цены (`Type price`) выбран `Orderbook` или `Orderbook+filter` то в качестве объема для однократного входа в позицию `v_in_right` не используется.

#### **5.2.11.3. v_out_left/v_out_right**

`v_out_left/v_out_right` - отвечает за минимальный/максимальный разрешенный объем для однократного выхода из позиции (в штуках портфелей);<br>
Если тип определения цены (`Type price`) выбран `Orderbook` или `Orderbook+filter` то в качестве объема для однократного выхода из позиции `v_out_right` не используется.

#### **5.2.11.4. Virt_0_pos**

`Virt_0_pos` - параметр позволяет `Is first` заявке, выставленной по алгоритму, по бумаге с направлением в сторону закрытия позиции не только сводить позицию к нулю, но и сразу открывать новую позицию с противоположным направлением, кроме того объем заявки никогда не может быть меньше `v_in_left` и `v_out_left`.

**Важно**: если установлен флаг [To0 5.2.26](), то можно получить такое поведение робота, что позиция никогда не попадает ровно в 0, а все время переворачивается то в одну, то в другую сторону.

#### **5.2.11.5. n_perc_fill**

`n_perc_fill` - параметр отвечает за связь позиции по главной бумаге и позиции по портфелю. Исходя из этого параметра осуществляется округление отношения позиции ([Curpos 5.3.6]()) по главному инструменту к параметру [Count 5.3.8]() того же инструмента. Значение `n_perc_fill` равное нулю отключает механизм округления, в результате позиция всегда округляется по модулю вниз. Во всех остальных случаях работают следующие правила:

* если при изменении позиции по главному инструменту портфеля целая часть позиции не изменилась, а остаток от деления нацело [Curpos 5.3.6]() на [Count 5.3.8]() находится в диапазоне от `(100 - n_perc_fill)` до `n_perc_fill` процентов от [Count 5.3.8](), то позиция по портфелю не меняется, если остаток слева от диапазона, то округление идет по модулю вниз, если остаток справа от диапазона, то округление идет по модулю вверх;

* если при увеличении позиции целая часть от деления нацело [Curpos 5.3.6]() на [Count 5.3.8]() увеличилась, а модуль остатка от деления нацело [Curpos 5.3.6]() на [Count 5.3.8]() больше или равен `n_perc_fill` процентов от [Count 5.3.8](), то позицию по портфелю округляем по модулю вверх, иначе вниз;

* если при уменьшении позиции целая часть от деления нацело [Curpos 5.3.6]() на [Count 5.3.8]() уменьшилась, а модуль остатка от деления нацело [Curpos 5.3.6]() на [Count 5.3.8]() меньше или равен `(100 - n_perc_fill)` процентов от [Count 5.3.8](), то позицию по портфелю округляем по модулю вниз, иначе вверх.

### **5.2.12. Delta**

`Delta` - минимальное отклонение `Price_s` и `Price_b` от цены выставленной заявки на продажу или покупку, соответственно, при превышении которого необходимо переставить котируемую заявку, то есть заявку по [Is first 5.3.11]() инструменту (используется только при включенном режиме [Quote 5.2.6]());

_Пример_:<br>
Delta = 10, Price_s = 95. Если котирующая заявка на продажу выставлена, то она переставится по новой цене в случае, если ее цена меньше 85 или больше 105.