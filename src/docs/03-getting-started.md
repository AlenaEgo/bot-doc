# **3. Начало работы**

Изначально, робот, созданный для клиента, не имеет транзакционных подключений и может не иметь активных необходимых маркетдата подключений к биржам (это не касается тестовых роботов для виртуальной торговли, в них сразу доступно получение маркетдаты со всех поддерживаемых бирж). Поэтому сначала необходимо настроить подключения для получения маркетдаты, а так же добавить транзакционные подключения.

## **3.1. Настройка подключений**

Видео, наглядно объясняющее процесс настройки подключений:

<iframe width="735" height="415" src="https://www.youtube.com/embed/s412pbSalGo" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


Для активации маркет-дата подключений необходимо выбрать виджет `Data Connections`, отметить галочками необходимые потоки маркет-даты, нажать значок шестеренка, выбрать робота, для которого добавляется подключение и выбрать действие `Enable`.

![Alt text](./00-img/3.1_1_2.jpg)

Для настройки торговых подключений необходимо выбрать виджет `Trade connections`, нажать значок шестеренка, выбрать робота, для которого добавляется подключение и выбрать действие `Add`.

![Alt text](./00-img/3.1_2_2.jpg)

В открывшемся окне необходимо заполнить поля параметров подключения.
После заполнения всех полей параметров подключения необходимо нажать `Add connection`.

**Важно:** если подключение находится в статусе `Connecting` или `Disconnect`, техническая поддержка сообщает об этом клиенту. В случае, когда клиент не приводит настройки подключения в соответствие с необходимыми (статус должен быть отмечен зеленым цветом) и не реагирует на сообщения в течение 24 часов, техническая поддержка оставляет за собой право перевести такое подключение в статус `Disable`. Это связано с тем, что некорректно настроенное подключение приводит к нежелательной и избыточной активности на бирже. В ответ на подобные действия биржа может заблокировать доступ для клиента. 



## **3.2. Тelegram-бот**

Для телеграм-оповещений используется новый телеграм-бот [FKVikingBot](https://t.me/FKVikingBot). Необходимо добавить его в свой телеграм-акаунт, перейдя по ссылке и нажав кнопку "START" в диалоге общения с телеграм-ботом. 

**Важно:** 

Новый телеграм-бот только присылает оповещения, функции управления роботом у него нет.


## **3.3. Настройка портфелей**

Видео, наглядно объясняющее процесс создания торгового портфеля:

<iframe width="735" height="415" src="https://www.youtube.com/embed/m6tkfY9KQ_g" title="Создание портфеля" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

Для того, чтобы добавить портфель в древовидной структуре слева выбираем нужного робота, далее переходим во вкладку `Portfolios -> Portfolios`.
В открывшемся окне нажимаем на кнопку создания нового портфеля `Add`:

![Doc](./00-img/3-3-01.jpg)

Заполняем поля.`Name` - даем имя портфелю.
В поле `Exchanges` выбираем биржу, на которой будем искать бумаги и нажимаем кнопку `Reload security list from exchanges` чтобы обновить список доступных на бирже бумаг.
Ниже выбираем необходимые бумаги из списка:

![Doc](./00-img/3-3-02.jpg)

Для упрощения поиска используем фильтр. Пишем имя бумаги, например, "USD" и в списке останутся только те бумаги, где присутствует "USD".
Чтобы добавить интересующую бумагу в портфель, необходимо сделать даблклик по зеленому плюсику в строчке соответствующей бумаги. Убедиться, что бумага добавилась, можно посмотрев на список бумаг портфеля `Portfolio securities` чуть выше на странице. В дальнейшем можно будет вернуться на этот шаг и отредактировать бумаги портфеля, удалив лишние и добавив нужные.
Как только бумаги добавлены, нажимаем кнопку `Add portfolio`. Откроется окно с настройками портфеля. Здесь задаются торговые параметры портфеля и инструментов портфеля, почитать о них можно, нажав на знак вопроса рядом с интересующим параметром, или по ссылкам [параметры портфеля](/docs/05-params-description.html#_5-2-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B-%D0%BF%D0%BE%D1%80%D1%82%D1%84%D0%B5%D0%BB%D1%8F) и [параметры инструментов портфеля](/docs/05-params-description.html#_5-3-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B-%D0%B8%D0%BD%D1%81%D1%82%D1%80%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2-%D0%BF%D0%BE%D1%80%D1%82%D1%84%D0%B5%D0%BB%D1%8F):

![Doc](./00-img/3-3-03.jpg)

Для реальной (не виртуальной) торговли в поле `Client code` необходимо поменять значение `virtual`, на транзакционное подключение, которое создали ранее.
Так же внизу страницы можно настроить расписание портфеля:

![Doc](./00-img/3-3-04.jpg)

Можно обозначить начало и конец периода, и действия, которые должны в это время происходить.
После всех настроек нажмаем `Apply` внизу страницы. Портфель создан. Если расписание не было задано, то необходимо включать торговлю по портфелю вручную с помощью флагов `re_sell/re_buy`.

Перечеркнутый инструмент в портфеле означает, что срок экспирации бумаги наступит через 3 или менее суток (исключая неторговые дни). Если портфель содержит хотя бы один такой инструмент, значит он тоже будет отображаться перечеркнутым.

## **3.4. Управление портфелями**

Над таблицей портфелей находится блок кнопок, обеспечивающих управление портфелями.

Кнопка "**►**" - включает торговлю по выбранным портфелям. При настройке расписания торгов с помощью параметра [Timetable](/docs/05-params-description.html#_5-2-24-timetable) включение торговли по кнопке "**►**" не работает.

Кнопка "**■**" - выключает торговлю по выбранным портфелям. Заявки по первой ноге снимаются, заявки второй ноги остаются висеть в рынке и переставляются в соответствии с настройками [SL](/docs/05-params-description.html#_5-3-15-sl) и [Timer](/docs/05-params-description.html#_5-3-17-timer). При настройке расписания торгов с помощью параметра [Timetable](/docs/05-params-description.html#_5-2-24-Timetable) выключение торговли по кнопке "**■**" не работает.

Кнопка `Action` открывает меню действий, применимых к портфелям. Там содержатся следующие пункты:

**Hard stop** - останавливает торговлю по выбранным портфелям (снимаются галочки `re_sell, re_buy`), пытается снять выставленные заявки по обеим ногам и отключает расписание (снимается флаг [Use timetable](/docs/05-params-description.html#_5-2-24-use-timetable)). Это полная остановка торговли по выбранным портфелям, после которой не будет никаких выставлений или переставлений заявок ни по одному из инструментов портфелей.
**:Важно:**
Если в некоторых портфелях были добавлены формулы в которых настроено поведение re_sell, re_buy то торговля может продолжиться в соответствии с настроенными формулами.

**Clone portfolio** - клонирует выбранный портфель.

**Reset statuses** - сброс `Sell_status` и `Buy_status` выделенных портфелей.  
Бывают ситуации, например, когда происходят сбои в работе биржи, и получается так, что заявка выставляется роботом, а потом снимается биржей, но никак не информируя робот о снятии. В таком случае заявка зависает в своем текущем, внутреннем для робота, статусе.
Пользоваться этой кнопкой можно **ТОЛЬКО В КРАЙНИХ СЛУЧАЯХ**, когда торговля по портфелю отключена и вы уверены что нет ни одной активной заявки по данному портфелю, в противном случае робот потеряет активные заявки, что приведет к неправильной позиции по бумагам в роботе.
**:Важно:**
После использования этой кнопки необходимо убедиться, что нет никаких активных заявок на бирже и позиции на бирже соответствуют тем, что в роботе.

**Stop formulas** - останавливает торговлю по выбранным портфелям (снимаются галочки `re_sell, re_buy`), пытается снять выставленные заявки по обеим ногам и отключает расписание (снимается флаг [Use timetable](/docs/05-params-description.html#_5-2-24-use-timetable)). Так же отключаются все расчёты по формулам, т.е. снимаются флаги портфеля `Custom_trade` и `Extra_formulas` и для каждого из инструментов портфеля в полях `Count_type` и `Ratio_type` устанавливается тип, соответствующий константному значению. Для дальнейшего использования формул включать их нужно самостоятельно.

**Remove** - удаляет выделенные портфели.

**Disable/Enable** - исключает портфель из расчётов или возвращает портфель обратно в обычный режим работы. Не стоит путать эту возможность с включением и выключением торговли по портфелю. Использование Disable позволяет исключить неиспользуемый в данный момент портфель из расчётов. По всем инструментам портфеля перестанут приходить цены и строиться стаканы (только если инструменты не используются в других портфелях). Редактирование параметров портфеля в статусе Disable невозможно. Будьте внимательны! Перед тем, как перевести портфель в режим Disabled, убедитесь, что торговля по портфелю выключена, заявки по инструментам портфеля не висят на бирже и не выставляются в данный момент, кроме того, проверьте, что поля портфеля и его инструменты не используются в формулах других портфелей. Также следует учитывать, что возвращение портфеля из состояния Disabled в рабочее состояние, может привести к переоткрытию торгового стакана.

**Export/Import** - экспортировать выбранный портфель из робота на компьютер в виде `.ini` файла или импортировать портфель в робота.

Кнопка **Table** открывает меню действий, применимых к таблице. Там содержатся следующие пункты: `Columns` - меню редактирования параметров таблицы портфелей. В нём можно скрывать столбцы, перемещать их местами.

**Filter** - включение и отключение окошка фильтра над таблицей. Пункт `Show` показывает окошко фильтра, пункт `Hide` скрывает его. Фильтр служит для поиска среди своих портфелей по параметрам.

**:Важно:** На новом сайте отсутствует возможность импортировать портфель если еще нет маркет-дата подключений.

**Замена инструмента портфеля**

Если требуется поменять один из инструментов портфеля, то лучше использовать функцию замены инструмента, а не удаления с последующим добавлением нового инструмента. При замене инструмента будет отображен список всех формул всех портфелей, где используется данный инструмент. Благодаря этому, можно в полуавтоматическом режиме поменять один инструмент на новый во всех формулах. Этот механизм может быть полезен, например, при замене одного фьючерса в портфеле другим, с сохранением уже настроенных параметров у инструмента, который нужно заменить. Для того чтобы воспользоваться функцией замены инструмента, нужно зайти в настройки портфеля, в таблице `Securitie`s выбрать инструмент, который следует заменить, далее в меню `Action` выбрать пункт `Replace`.
