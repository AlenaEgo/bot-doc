# **4. Добавление подключений**

В данном разделе описаны подключения к биржам/брокерам, рынкам, поддерживаемым роботом, и описаны все параметры, используемые при создании каждого подключения.

## **4.1. MOEX FORTS**
___

### **4.1.1. TWIME**

При заказе данного подключения следует учесть, что 2 логина по 30 транзакций/сек будут работать лучше, чем один на 60 транзакций/сек (см. [Round robin](https://fkviking.github.io/bot-doc/docs/04-creating-connection.html#_4-1-moex-forts)).

#### **4.1.1.1. Name**

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке транзакционных подключений ему было проще ориентироваться. Разрешенные символы: `_ a-z A-Z 0-9`.

#### **4.1.1.2. Credentials**

Credentials предоставляются брокером.

#### **4.1.1.3. Trading account(s)**

Торговый счёт, предоставляется брокером. Также его еще можно посмотреть в терминале (если счетов несколько, укажите их через запятую):

![](./00-img/4-1-1-3.png)

#### **4.1.1.4. Comment**

Уникальный идентификатор для всех заявок для данного подключения, задаётся пользователем для собственного удобства. Если не используется, оставляйте 0. Представляет из себя целое число от 0 до 1023.

#### **4.1.1.5. Round robin**

По-умолчанию включено. Включение и выключение режима `Round robin` для данного подключения.
Для увеличения производительности можно использовать несколько TWIME подключений с одинаковым [Trading account(s)](https://fkviking.github.io/bot-doc/docs/04-creating-connection.html#_4-1-moex-forts). При заказе TWIME подключения следует учесть, что 2 логина по 30 транзакций/сек к одному торговому счету в режиме `Round robin` будут работать лучше, чем один логин на 60 транзакций/сек. В этом режиме робот будет бросать заявки в несколько логинов по-очереди.

#### **4.1.1.6. Max trans**

Лимит транзакций в секунду. В анкете у Вас указана производительность логина в единицах производительности, где 1 единица равна 30 транзакциям в секунду.

#### **4.1.1.7. Reserved trans**

По-умолчанию 0. Количество зарезервированных транзакций в секунду для заявок на удаление. Использование данного параметра уменьшает количество выставлений заявки, доступных за одну секунду [Max trans](https://fkviking.github.io/bot-doc/docs/04-creating-connection.html#_4-1-moex-forts), но позволяет увеличить вероятность того, что робот успеет отдернуть (снять) заявку при уходе цен.

#### **4.1.1.8. Move order**

По-умолчанию разрешено. Разрешить или запретить использование приказов на переставление (изменение) заявки для данного подключения.

#### **4.1.1.9. Bind IP**

IP-адрес, с которого будет происходить подключение к бирже. IP адрес должен быть указан в договоре с брокером.

### **4.1.2. FAST (FIX Adapted for STreaming)**

Данное подключение имеет в своем составе 4 потока. Это сделано для того, чтобы отделить часто не используемые опционы. А также отделить ресурсоемкий но быстрый Orderlog от чуть более медленного, но лёгкого потока Best prices.

#### **4.1.2.1. Definitions**

Для того, чтобы подключение работало, нужно обязательно раздизейблить данный поток. Кроме определений инструментов, в нем также ходят торговые статусы инструментов.

#### **4.1.2.2. Best prices**

Поток лучших цен. Не является обязатеьным. Автоматически отключается при раздизейбливании потока Orderlog, т.к биржа не предусмотрела возможности объединения потоков на FAST срочного рынке.

#### **4.1.2.3. Orderlog**

Поток всех заявок. на его основании строится стакан. Является более быстрым по сравнению с потоком Best prices. При раздизейбливании данного потока автоматически отключается поток Best prices, т.к биржа не предусмотрела возможности их объединения.

#### **4.1.2.4. Options definitions**

Для того, чтобы торговать опционами, необходимо раздизейблить данный поток.

## **4.2. MOEX Spot**
___

### **4.2.1. FIX (Financial Information eXchange)**

При подключении к фондовому рынку советуем заказать сразу 3 (три) логина к одному торговому счету, т.к на фондовом рынке 3 (три) фикс сервера, и иногда один или два могут выйти из строя. Таким образом будет повышена отказоустойчивость вашей торговли `Нет ссылки` ([см. Round robin]()).

#### **4.2.1.1. Name**

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке транзакционных подключений ему было проще ориентироваться.

#### **4.2.1.2. Server**

Адрес FIX-сервера биржи, к которому будет выполняться подключение.

#### **4.2.1.3. SenderCompID**

Значение данного параметра предоставляется брокером.

#### **4.2.1.4. Password**

Пароль для данного FIX-подключения. Если не меняли, то используйте стандартный, указанный в поле для ввода.

#### **4.2.1.5. Trading account(s)**

Торговый счёт, предоставляется брокером. Также его еще можно посмотреть в терминале (если счетов несколько, укажите их через запятую):

![](./00-img/4-2-1-5.png)

#### **4.2.1.6. Round robin**

Включение и выключение `Round robin` для данного коннекта.
Для отказоустойчивости советуем использовать сразу три FIX подключения к фондовому рынку с одинаковым `Нет ссылки` [Trading account(s)](https://bot.fkviking.com/v2/ru/doc/ru#MOEX_SPOT_FIX_Trading_account). В режиме `Round robin` робот будет изпользовать их по-очереди, и внештатное отключение одного из FIX серверов биржи не приведет к остановке торговли.

#### **4.2.1.7. Client code**

Код клиента можно посмотреть в привязанном к счёту терминале (нажать F7 и открыть таблицу "Позиции по деньгам") или запросить у брокера:

![](./00-img/4-2-1-7.png)

#### **4.2.1.8. Firm level account**

Указание на то, что ваш аккаунт является аккаунтом уровня фирмы. Обычно брокер не знает, какого уровня аккаунт, так что приходится подбирать.

#### **4.2.1.9. Bind IP**

IP-адрес, с которого будет происходить подключение к бирже. IP адрес должен быть указан в договоре с брокером.

### **4.2.2. FAST**

Данное подключение имеет в своем составе 3 потока. Это сделано для того, чтобы отделить Orderlog от потока Best prices. Они имеют одинаковомю скорость и биржа предусмотрела возможность их объединения, так что их можно включать одновременно. Но Best prices, очевидно, менее ресурсоемкий.

#### **4.2.2.1. Definitions**

Для того, чтобы подключение работало, нужно обязательно раздизейблить данный поток. Кроме определений инструментов, в нем также ходят торговые статусы инструментов.

#### **4.2.2.2. Best prices**

Поток лучших цен. Советуем включать его одновременно с потоком Orderlog.

#### **4.2.2.3. Orderlog**

Поток всех заявок. Советуем включать его одновременно с потоком Best prices.

## **4.3. MOEX Currency**
___

### **4.3.1. FIX**

При подключении к валютному рынку советуем заказать сразу 5 (пять) логинов к одному торговому счету, т.к на валютном рынке 5 (пять) фикс серверов, и иногда один или два могут выйти из строя. Таким образом будет повышена отказоустойчивость вашей торговли. `Нужна ссылка` (см. Round robin).

#### **4.3.1.1. Name**

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке транзакционных подключений ему было проще ориентироваться.

#### **4.3.1.2. Server**

Адрес FIX-сервера биржи, к которому будет выполняться подключение. Выбирайте разные для повышения отказоустойчивости.

#### **4.3.1.3. SenderCompID**

Значение данного параметра предоставляется брокером.

#### **4.3.1.4. Password**

Пароль для данного FIX-подключения. Если не меняли, то используйте стандартный, указанный в поле для ввода.

#### **4.3.1.5. Trading account(s)**

Торговый счёт, предоставляется брокером, так же можно посмотреть в терминале.
Если счетов несколько, укажите их через запятую.

![](./00-img/4-3-1-5.png)

#### **4.3.1.6. Round robin**

Включение и выключение Round robin'a для данного коннекта.
Для отказоустойчивости советуем использовать сразу 5 (пять) FIX подключений к валютному рынку с одинаковым `Нужна ссылка` [Trading account(s)](). В режиме Round robin робот будет изпользовать их по-очереди, и внештатное отключение одного из FIX серверов биржи не приведет к остановке торговли.

#### **4.3.1.7. Client code**

Код клиента можно посмотреть в привязанном к счёту терминале (нажать F7 и открыть таблицу "Позиции по деньгам") или запросить у брокера.
При вводе нужно добавить два слеша '//' в конце. В зависимости от инструкций брокера возможно один в конце и один в середине. Если инструкций не было, оставьте два в конце.

![](./00-img/4-3-1-7.png)

#### **4.3.1.8. Firm level account**

Указание на то, что ваш аккаунт является аккаунтом уровня фирмы. Обычно брокер не знает, какого уровня аккаунт, так что приходится подбирать.

#### **4.3.1.9. Bind IP**

IP-адрес, с которого будет происходить подключение к бирже. IP адрес должен быть указан в договоре с брокером.

### **4.3.2. FAST**

Данное подключение имеет в своем составе 3 потока. Это сделано для того, чтобы отделить Orderlog от потока Best prices. Они имеют одинаковомю скорость и биржа предусмотрела возможность их объединения, так что их можно включать одновременно. Но Best prices, очевидно, менее ресурсоемкий.

#### **4.3.2.1. Definitions**

Для того, чтобы подключение работало, нужно обязательно раздизейблить данный поток. Кроме определений инструментов, в нем также ходят торговые статусы инструментов.

#### **4.3.2.2. Best prices**

Поток лучших цен. Советуем включать его одновременно с потоком Orderlog.

#### **4.3.2.3. Orderlog**

Поток всех заявок. Советуем включать его одновременно с потоком Best prices.

### **4.3.3. FAST Indexes**

Чтобы увидеть и добавить индексы в портфель, необходимо раздизейблить данный поток. Цены по индексам ходят в потоках FAST FUT Best prices и Orderlog срочного рынка. Так что также должен быть включен один из этих двух потоков.

## **4.4. SPBEX**
___

`ДАЛЬШЕ НЕ ОБРАБОТАНО!!!`
4.4.1. Бинарная маркетдата

Маркетдата подключение состоит их нескольких потоков данных, вы можете активировать только те потоки, которые вам не обходимы, и отключить ненужные.
Если имя инструмента начинается на SPB_MM_, то это инструмент только СПб ликвидности (заявки и сделки непосредственно с СПб биржи), если же имя начинается на SPB_AGGR_, то это инструмент агрегированной ликвидности с различных бирж. Если вы являетесь маркет-мейкером, то скорее всего вам доступна торговля только в СПб ликвидность.



4.4.1.1. Definitions

Поток определений финансовых интсрументов. Для того, чтобы подключение работало, необходимо обязательно активировать данный поток. Также в данном потоке ходят торговые статусы и лимиты цен финансовых инструментов



4.4.1.2. Commons

Поток статистических рыночных параметров. В алгоритме робота никак не используется, но доступен в C++ интерфейсе



4.4.1.3. Top of book

Поток лучших цен покупки и продажи. Советуем включать его одновременно с потоком Orderbok



4.4.1.4. Orderbook

Поток торгового стакана. Советуем включать его одновременно с потоком Top of book



4.4.2. Бинарный торговый

Убедитесь, что заказали именно бинарный, а не FIX логин. На один логин невозможно несколько одновременных подключений



4.4.2.1. Name

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке транзакционных подключений ему было проще ориентироваться. Разрешенные символы: _ a-z A-Z 0-9



4.4.2.2. Connection type

Direct - это обычное подключение, которое напрямую подключается к бирже
Proxy - используется для торговли несколькими роботами через одно подключение



4.4.2.3. Login

Логин для доступа к бирже, берется из договора с биржей



4.4.2.4. Password

Пароль для доступа к бирже, берется из договора с биржей



4.4.2.5. Trading account(s)

Торговый счёт, берется из договора с биржей. Можете добавить несколько через запятую.



4.4.2.6. Member ID

Идентификатор участника торгов, по умолчанию равно 0. Если не подойдет, то нужно уточнять у биржи



4.4.2.7. Client ID

Идентификатор клиентского кода, берется из договора с биржей.



4.4.2.8. Market ID

Идентификатор пула ликвидности. Допустимые значения: 0 (ликвидность определяется автоматически по финансовому инструменту), 1000 (для адресных инструментов, ликвидность только СПб биржи) и 1001 (для анонимных инструментов, агрегированная ликвидность).



4.4.2.9. Comment

Клиентский комментарий к заявкам



4.4.2.10. Bind IP

IP-адрес, с которого будет происходить подключение к бирже. IP адрес должен быть указан в договоре



4.4.3. Бинарный торговый через прокси

Используется в случае, когда нескольким роботам необходимо торговать через одно и то же транзакционное подключение (т.е. с одного логина). Настраивается службой поддержки по предоставленным пользователем параметрам, параметры те же, что и для Бинарный торговый.



4.4.3.1. Name

Это значение должно соответствовать названию разделенной области памяти, через которую будет идти обмен сообщениями. Уточняйте имя у службы поддержки



4.5. EXANTE

В роботе поддерживается только FIX-подключение к брокеру EXANTE. При добавлении транзакционного подключения создаются два FIX-подключения: маркетдата и транзакционное. Активировать и деактивировать такую пару подключений можно только вместе, т.е. при попытке деактивировать маркетдата подключение будет деактивировано соответствующее транзакционное подключение и наоборот. Так как брокер EXANTE может предоставлять рыночные данные с большого числа бирж, то поле Exchange filter с указанием списка необходимых вам бирж является обязательным для заполнения. Настоятельно рекомендуется указывать только те биржи, инструментами с которых вы действительно планируете пользоваться.




4.5.1. Name

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке транзакционных подключений ему было проще ориентироваться. Разрешенные символы: _ a-z A-Z 0-9



4.5.2. Conn type

Выбор сервера, к которому будет осуществляться подключение. Все сервера идентичны с точки зрения протокола и предоставляемой информации. Разница только в их местоположении.



4.5.3. SenderCompID (trade)

Уникальный идентификатор клиента для торгового подключения, предоставляется брокером.



4.5.4. Password (trade)

Пароль для торгового подключения, предоставляется брокером. Если брокер предоставил только один пароль, то, скорее всего пароли маркетдата и торгового подключений совпадают.



4.5.5. Trading account(s)

Идентификатор аккаунта клиента, берется у брокера. Можете добавить несколько через запятую.



4.5.6. Max trans

Один из параметров системы предупреждения флуда. Чтобы не натыкаться на флуд-контроль со стороны брокера, мы сами считаем отправляемые сообщения. Этот параметр определяет количество сообщений за промежуток времени. Если количество сообщений за временной промежуток Max trans interval выше данного значения, то робот перестаёт отправлять сообщения брокеру.



4.5.7. Max trans interval

Один из параметров системы предупреждения флуда. Чтобы не натыкаться на флуд-контроль со стороны брокера, мы сами считаем отправляемые сообщения. Этот параметр определяет промежуток времени. Если количество сообщений за этот временной промежуток выше значения Max trans, то робот перестаёт отправлять сообщения брокеру.



4.5.8. Transactions reserved

Один из параметров системы предупреждения флуда. Этот параметр определяет сколько транзакций зарезервировано под снятие заявок во временной промежуток Max trans interval. Т.е. даже если выставление заявок будет нарываться на внутренний флуд контроль робота, робот сможет отправить заявки на снятие в количестве Transactions reserved штук.



4.5.9. SenderCompID (feed)

Уникальный идентификатор клиента для маркетдата подключения, предоставляется брокером.



4.5.10. Password (feed)

Пароль для маркетдата подключения, предоставляется брокером. Если брокер предоставил только один пароль, то, скорее всего пароли маркетдата и торгового подключений совпадают.



4.5.11. Exchange filter

Список бирж (через запятую), данные с которых вы хотели бы получать. Необходимо указать хотя бы одну биржу. Нам известно о возможности получения данных со следующих рынков: a3ecs, absv, adc, af, ai, aicf, aig, aix, altimaam, am1, amex, apis, arca, arg, argo, asc, ascg, asn, asx, asyl, ath, aud, audc, avm, avtf, bats, bist, blackbox, bm, bmf, bmi, bostonzechiel, btm, c.index, cad, carf, cboe, cbot, ccf, chf, cme, comex, courant, cpf, cpm, dam, dcm, diadema, diamageca, dim, dml, dnci, dominion, dsl, e, eam, ec, egam, emea, enam, esplanade, eur, eurex, euronext, exante, fiscoam, forts, fqf, fqifl, fwb, gbp, geist, gk, ham, hkex, htf, ice, inc, index, ipo, iq69, iqsf, jordancap, jse, kgrcap, kif, ky, laif, lat, lcm, lgml, libor, liffe, llcp, lme, lse, lseaim, lseiob, lux, lvam, micex, mifm, mil, moex.tom, mpi, mse, mtg, muskokacap, nasdaq, ncc, ncl, nf, niton, nnps, nomx, ns, nse, nymex, nyse, nzx, oameur, oamusd, oe, oef, oic, omxc, omxh, ose, otcbb, otcmkts, paf, pils, pl, pse, pvb, quan, rig, rub, sb, sek, sgx, sicav, six, smn, somx, ssh, tase, tmx, tocom, tse, tsf, uah, us, uscorp, usd, vse, wcf, wse, xetra, xpira.



4.5.12. Ticker dictionary

Словарь сопоставлений имён тикеров при использовании маркетдаты с EXANTE и торгового подключения CQG. Имена тикеров указываются в формате "NG:NGE,SI:SIE,B:QO", сначала указывается имя тикера на EXANTE, потом имя тикера CQG. Если использовать торговое подключение CQG не предполагается, то данное поле можно оставить пустым.



4.5.13. Bind IP

Если в договоре не прописано подключение с фиксированного IP-адреса, то следует указать значение Automatic. В противном случае следует обратиться в поддержку для уточнения адреса сервера. Адрес, указанный в этом поле, не следует предоставлять бирже, как адрес сервера.



4.6. CQG

В роботе поддерживается только транзакционное FIX-подключение к брокеру CQG. Транзакционное подключение CQG может работать только в паре с маркетдата подключением EXANTE. Так как на EXANTE и CQG имена тикеров не совпадают, то при добавлении подключения EXANTE следует заполнить словарь соответствия имён тикеров Ticker dictionary, добавив туда те инструменты, которыми планируете пользоваться.




4.6.1. Name

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке транзакционных подключений ему было проще ориентироваться. Разрешенные символы: _ a-z A-Z 0-9



4.6.2. Server

Выбор сервера, к которому будет осуществляться подключение. Все сервера идентичны с точки зрения протокола и предоставляемой информации. Разница только в их местоположении.



4.6.3. SenderCompID

Уникальный идентификатор клиента, предоставляется брокером.



4.6.4. Password

Пароль для подключения, предоставляется брокером.



4.6.5. SenderSubID

Дополнительный идентификатор подключения. Следует оставить значение по умолчанию, если брокером не предоставлено другое значение.



4.6.6. Client code

Код клиента, предоставляется брокером.



4.6.7. Bind IP

Если в договоре не прописано подключение с фиксированного IP-адреса, то следует указать значение Automatic. В противном случае следует обратиться в поддержку для уточнения адреса сервера. Адрес, указанный в этом поле, не следует предоставлять бирже, как адрес сервера.



4.7. KRAKEN

Подключение к рынку Spot биржи KRAKEN. В роботе поддерживается только подключение на основе Websocket и REST API. Маркетдата подключение активируется как описано в главе Настройка подключений. Параметры транзакционного подключения описаны ниже




4.7.1. Name

Поле для задания имени подключения. Это значение пользователь задаёт для своего удобства, чтобы потом в списке транзакционных подключений ему было проще ориентироваться. Разрешенные символы: _ a-z A-Z 0-9



4.7.2. API Key

Публичный ключ для доступа к API биржи, создаётся в личном кабинете на сайте биржи. Создаётся вместе с соотвествующим секретным ключом. Находится в настройках в разделе API. Для ключа следует установить следующие разрешения: "Query Funds", "Query Open Orders & Trades", "Query Closed Orders & Trades", "Create & Modify Orders", "Cancel/Close Orders", "Access WebSockets API", "Export Data". Ключ должен быть новым, не использованным нигде ранее.



4.7.3. Secret

Секретный ключ для доступа к API биржи, создаётся в личном кабинете на сайте биржи. Создаётся вместе с соотвествующим публичным ключом. Находится в настройках в разделе API. Для ключа следует установить следующие разрешения: "Query Funds", "Query Open Orders & Trades", "Query Closed Orders & Trades", "Create & Modify Orders", "Cancel/Close Orders", "Access WebSockets API", "Export Data". Ключ должен быть новым, не использованным нигде ранее.



4.7.4. Cancel on disconnect

Флаг, отвечающий за автоматическое снятие заявок биржей, при разрыве связи между биржей и роботом.



4.7.5. Bind IP

Если в договоре не прописано подключение с фиксированного IP-адреса, то следует указать значение Automatic. В противном случае следует обратиться в поддержку для уточнения адреса сервера. Адрес, указанный в этом поле, не следует предоставлять бирже, как адрес сервера.