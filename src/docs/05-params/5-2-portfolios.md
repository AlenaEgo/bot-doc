# **5.2. Параметры портфеля**

Далее дано описание параметров портфеля. Все параметры являются редактируемыми, если прямо не указано иное. Описания некоторых параметров портфеля объединены в группы для удобства восприятия.

## **5.2.1. Name**

`Name` - имя портфеля. В данном поле можно использовать латинские буквы и цифры, максимум 30 символов. Имя не редактируется. Для изменения имени можете выключить торговлю, склонировать портфель, изменить имя склонированного портфеля и удалить предыдущий портфель.

## **5.2.2. re_sell/re_buy**

`re_sell/re_buy` - разрешена продажа/покупка (при взведении флага включает робот на продажу/покупку).

**Важно :** при снятии галок `re_sell` и `re_buy` происходит сброс счетчика ошибок робота.

## **5.2.3. Type**

`Type` - тип торгового алгоритма портфеля:

- `Arbitrage` - обычная арбитражная торговля с использованием всех заданных параметров. Сначала выставляется заявка по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) на  инструменту, при её сведении в сделку выставляются заявки по остальным инструментам портфеля.

- `Option hedge` - режим хеджирования, `count` всех инструментов кроме [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) равен единице, `count` для [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) инструмента задается как delta - "грек", вычисляемый с использованием модели Блека-Шоулза, [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) инструмент в таком режиме должен быть опционом.

- `Test algo` - тестовый режим для проверки скорости работы "движков" подключений на получение рыночных данных и на выставление заявок, использовать данный режим без обращения к технической поддержке НЕ рекомендуется, прибыли он НЕ приносит.

- `TP algo` - режим работы с выставлением "take profit" заявки по главному инструменту. По главному инструменту держится только одна TP заявка, после прохождения не TP заявок в сделку, заявка TP снимается и выставляется новым объёмом. Заявки по второй ноге при этом не выставляются.

- TP algo 2 - режим работы с выставлением "take profit" заявки по главному инструменту. После каждой сделки по не TP заявке, выставляется новая TP заявка. У выставленной заявки есть [Timer](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-17-timer) и [SL](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-15-sl). Заявки по второй ноге выставляются так же, как и в режиме `Arbitrage`.

**Важно:** Если включен `hedge sec`, то каждые `hedge sec` секунд если позиция по главному инструменту портфеля ненулевая и нет выставляющихся или стоящих заявок, сводящих эту позицию к нулю, будет выставляться заявка, сводящая позицию к нулю; описанное выше распространяется и на позиции, открытые кликером; закрытие по hedge sec возможно только после того, как были сделки по главной бумаге по алгоритму (не по кликеру). Пока сделок не было, нет цен от которых откладывать тейк.

## **5.2.4. Type trade**

`Type trade` - тип торговли, используется при расчете цен [Sell/Buy](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-39-sell-buy), [Price_s/Price_b](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-40-price-s-price-b):

- `Price` - режим торговли с расчетом вышеперечисленных цен по ценам инструментов на покупку и продажу.

- IV - режим торговли с расчетом вышеперечисленных цен по "implied volatility" инструментов с использованием модели Блека-Шоулза.

## **5.2.5. Type price**

`Type price` - тип определения цены инструмента:

- `Bid/offer`- использовать лучшую цену на покупку и лучшую цену на продажу.

- `Orderbook` - параметр позволяет искать цену в стакане, таким образом, чтобы набрать необходимый объем. Цены на покупку и продажу набираются среди цен в стакане, начиная от лучшей цены в нужном направлении и далее вглубь стакана. Поиск необходимого объема происходит с помощью данной формулы:

![Alt text](../00-img/5-2-5.jpg)

$Count \times Percent \; of \; quantity \times 0.01 \times \begin{cases} v\_in\_left, & \mbox{if } open \; pos \\ v\_out\_left, & \mbox{if } close \; pos \end{cases}$,

- `Orderbook+filter` - аналогично Orderbook, но вычитать из набираемого объема цены своих заявок (если на соответствующих ценах присутствуют свои заявки).

## **5.2.6. Quote**

`Quote` - параметр позволяет котировать инструмент. Если включен, то заявка всегда держится в стакане, если выключено, то заявка на продажу выставляется когда `Sell ≥ Lim_Sell`, а заявка на покупку выставляется когда `Buy ≤ Lim_Buy`.

Видео объясняющее работу данного параметра:

<iframe width="735" height="415" src="https://www.youtube.com/embed/CfY5ZeS8aJM" title="Описание параметра Quote" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

## **5.2.7. Order ID**

`Order ID` - идентификатор всех заявок портфеля, так же определяет приоритет вызова торгового алгоритма портфеля.

_Пример_:  
Пусть есть несколько портфелей и во всех этих портфелях есть один и тот же инструмент. При изменении цены или объема лучшей цены на покупку или продажу по данному инструменту вызывается алгоритм торговли по всем портфелям, в которых этот инструмент присутствует. Торговый алгоритм портфелей будет вызываться в порядке возрастания Order ID, т.е. самым первым вызовется торговый алгоритм портфеля с Order ID = a, а самым последним с Order ID = z. При совпадении Order ID у разных портфелей порядок вызова торгового алгоритма портфелей НЕ определен и будет произвольным.

## **5.2.8. Hedge (sec)**

`Hedge (sec)` - интервал времени в секундах по прошествии которого автоматически хеджировать незахеджированную позицию в случаях, когда заявка по второй ноге не выставилась по алгоритму (случаи связанные с техническими проблемами на самой бирже, ограничениями по рейтлимиту и другими не рыночными ситуациями). Если задать значение "-1", то проверка по таймеру на незахеджированность не осуществляется.

**Неочевидный момент:**  
Если позиция, с учетом прохождения текущих активных заявок, расходится больше чем на значение [Overlay](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-17-overlay) (активные заявки могут быть), то подравняется позиция не трогая текущих активных заявок. Если подравнивающая заявка выставилась, то скинется счетчик ошибок для данной бумаги. Расхождение считается отдельно для каждого из инструментов второй ноги. Выравнивание также осуществляется по каждому из инструментов второй ноги отдельно. В один момент времени на каждом из инструментов второй ноги может висеть не более одной выравнивающей заявки. Выравнивающая заявка, в случае если она не прошла в сделку, переставляется раз в секунду (поведение совпадает со стоп лосс заявкой).

## **5.2.9. Simply first**

`Symply first` - если параметр включен, то когда цены [Price_s/Price_b](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-40-price-s-price-b) попадают в спред или на противоположную сторону стакана, то они всегда будут выставляться не глубже, чем на один шаг цены в спред:

![Alt text](../00-img/5-2-9.jpg)

где `bid`, `offer`, `step` - это бид, оффер и шаг цены по [Is first 5.3.11](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге, нижний индекс "0" означает текущее значение параметра, нижний индекс "1" означает новое значение параметра.  
Если у [Is first 5.3.11](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаги взведен флаг `Maker` и текущий спред в стакане равен одному шагу цены, то заявка на продажу будет выставлена по цене offer, а на покупку по цене bid (в противном случае заявка просто не смогла бы выставиться и "спамила" бы биржу).

**Важно:** если наша заявка становится бидом или оффером, при этом является единственной заявкой на данном ценовом уровне и цена следующего уровня стакана отличается от цены нашей заявки более чем на один шаг цены, то заявка снимается и далее выставляется по ценам, описанным выше.

## **5.2.10. Equal prices**

Если галка не стоит, то цена второй ноги определяется исходя из цен, которые дали сигнал. Если галка стоит, то заявка по второй ноге будет выставлена по такой цене, чтобы `Sell = Lim_Sell` и `Buy = Lim_Buy` (работает только для портфелей с двумя бумагами).  
Таким образом цены в заявках будут строго соответствовать `Lim_sell`, даже если в моменте были лучшие цены.
Включение параметра способствует меньшему числу проскальзываний по второй ноге, но и уменьшает количество положительных проскальзываний (когда купили по цене лучшей, чем хотели).

_Пример_: в первой ноге стоит цена 100, в второй цена 95. Мы хотим купить в первой ноге по 100, если в второй тоже будет цена сто, т.е. раздвижка будет ноль. В моменте во второй ноге резко рынок дергается вверх и достигает 110.
Если галка стоит, то мы купим первую ногу по сто, и попытаемся продать вторую по 100 (т.к. нас устраивала раздвижка ноль).
Если галка НЕ стоит, то мы кинем на цену которые дали сигнал к сделке , т.е. первую также купим по сто, вторую попытаемся продать по 110.

Формула для цены второй ноги для покупки и продажи:

![Alt text](../00-img/5-2-10.jpg)

± - зависит от того, какой `On buy` на 2-й ноге `Buy`, тогда "+" или `Sell`.

## **5.2.11. Volumes**

`Volumes` - группа параметров отвечающих за объем выставляемых заявок. Группу можно разделить на две пары параметров: [v_in_left/v_in_right](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-11-2-v-in-left-v-in-right) и [v_out_left/v_out_right](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-11-3-v-out-left-v-out-right), а так же параметры [Virt_0_pos](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-11-4-virt-0-pos) и [n_perc_fill](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-11-5-n-perc-fill).

### **5.2.11.1. v_min/v_max**

`v_min/v_max` - минимальная/максимальная разрешенная позиция для главного инструмента портфеля. Измеряется в лотах.

### **5.2.11.2. v_in_left/v_in_right**

`v_in_left/v_in_right` - отвечает за минимальный/максимальный разрешенный объем для однократного входа в позицию (в штуках портфелей);  
Если тип определения цены (`Type price`) выбран `Orderbook` или `Orderbook+filter` то в качестве объема для однократного входа в позицию `v_in_right` не используется.

### **5.2.11.3. v_out_left/v_out_right**

`v_out_left/v_out_right` - отвечает за минимальный/максимальный разрешенный объем для однократного выхода из позиции (в штуках портфелей);  
Если тип определения цены (`Type price`) выбран `Orderbook` или `Orderbook+filter` то в качестве объема для однократного выхода из позиции `v_out_right` не используется.

### **5.2.11.4. Virt_0_pos**

`Virt_0_pos` - параметр позволяет `Is first` заявке, выставленной по алгоритму, по бумаге с направлением в сторону закрытия позиции не только сводить позицию к нулю, но и сразу открывать новую позицию с противоположным направлением, кроме того объем заявки никогда не может быть меньше `v_in_left` и `v_out_left`.

**Важно:** если установлен флаг [To0](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-26-to0), то можно получить такое поведение робота, что позиция никогда не попадает ровно в 0, а все время переворачивается то в одну, то в другую сторону.

### **5.2.11.5. n_perc_fill**

`n_perc_fill` - параметр отвечает за связь позиции по главной бумаге и позиции по портфелю. Исходя из этого параметра осуществляется округление отношения позиции ([Curpos](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-6-curpos)) по главному инструменту к параметру [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count) того же инструмента. Значение `n_perc_fill` равное нулю отключает механизм округления, в результате позиция всегда округляется по модулю вниз. Во всех остальных случаях работают следующие правила:

- если при изменении позиции по главному инструменту портфеля целая часть позиции не изменилась, а остаток от деления нацело [Curpos](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-6-curpos) на [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count) находится в диапазоне от `(100 - n_perc_fill)` до `n_perc_fill` процентов от [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count), то позиция по портфелю не меняется, если остаток слева от диапазона, то округление идет по модулю вниз, если остаток справа от диапазона, то округление идет по модулю вверх;

- если при увеличении позиции целая часть от деления нацело [Curpos](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-6-curpos)[Curpos](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-6-curpos) на [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count) увеличилась, а модуль остатка от деления нацело [Curpos](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-6-curpos) на [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count) больше или равен `n_perc_fill` процентов от [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count), то позицию по портфелю округляем по модулю вверх, иначе вниз;

- если при уменьшении позиции целая часть от деления нацело [Curpos](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-6-curpos) на [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count) уменьшилась, а модуль остатка от деления нацело [Curpos](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-6-curpos) на [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count) меньше или равен `(100 - n_perc_fill)` процентов от [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count), то позицию по портфелю округляем по модулю вниз, иначе вверх.

## **5.2.12. Delta**

`Delta` - минимальное отклонение `Price_s` и `Price_b` от цены выставленной заявки на продажу или покупку, соответственно, при превышении которого необходимо переставить котируемую заявку, то есть заявку по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) инструменту (используется только при включенном режиме [Quote](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-6-quote));

_Пример_:  
Delta = 10, Price_s = 95. Если котирующая заявка на продажу выставлена, то она переставится по новой цене в случае, если ее цена меньше 85 или больше 105.

## **5.2.13. First delta**

`First delta` – задается в процентах (%), котируемая заявка переставляется если ее текущий не исполненный объем меньше, чем `First delta` процентов от первоначального выставленного объема (используется только при включенном режиме [Quote](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-6-quote)).

_Пример_:  
First delta = 20. Вы котируете на продажу объёмом 100, в вас ударяются и выкупают по частям. Заявка висит до тех пор, пока её неисполненный объём больше или равен 20. Как только он становится меньше 20, заявка снимается и, если может, выставляется новая по цене `Price_s` в полном объёме.

## **5.2.14. Market volume**

`Market volume` - максимальное количество лотов по лучшей цене на продажу или покупку (или суммарное количество лотов в стакане до "нашей" предполагаемой цены если `Type price = Orderbook` или `Type price = Orderbook + filter`), соответственно, при котором выставляется заявка по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге, при условии, что заявка выставляется не в спред, если цена заявки попадает в спред то значение данного параметра не используется.

## **5.2.15. Price check**

`Price check` – если предполагаемая цена выставления заявки по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге попадает в стакан глубже, чем на `Price check` пунктов, то заявка не выставляется.
То есть, если `offer + Price check < Price_s`, где `offer` – лучшая цена на продажу [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) инструмента, то заявка выставлена не будет.
Для покупки аналогично.

## **5.2.16. Max not hedged**

`Max not hedged` - значение равное сумме допустимых незахеджированных открытий по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) инструменту (т.е. когда по любому из не [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) инструментов "висит" в рынке не менее, чем `Max not hedged` активных заявок) и ошибок выставления (все ошибки, кроме кроссов), после которой торговля по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) инструменту будет остановлена до тех пор пока хотя бы одна из незахеджированных позиций не захеджируется или не сбросится счетчик ошибок.

**Важно:** необходимо использовать параметр `Max not hedged` в связке с [Hedge (sec)](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-8-hedge-sec), так как иначе при накоплении определенного количества ошибок произойдет остановка торговли.
Используя в портфеле инструменты некоторых площадок с типами инструментов "купить/закрыть покупку", "продать/закрыть продажу" Max not hedged может иметь значение только "1".

## **5.2.17. Overlay**

`Overlay` – хеджировать только если разница (в портфелях) между [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумагой и остальными инструментами портфеля больше или равна значению данного параметра (в штуках портфелей, то есть в той же размерности, что и [v_in_left/v_in_right](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-11-2-v-in-left-v-in-right)).

## **5.2.18. Lim_sell/Lim_buy**

`Lim_Sell` – сигнальная цена на продажу, заявка по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге выставляется если `Sell ≥ Lim_Sell` вне зависимости от того включен или нет режим [Quote](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-6-quote).

`Lim_Buy` – сигнальная цена на покупку, заявка по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге выставляется если `Buy ≤ Lim_Buy` вне зависимости от того включен или нет режим [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first).

Работа данных параметров наглядно продемонстрирована в этом видео:

<iframe width="735" height="415" src="https://www.youtube.com/embed/DxLdFeUU_bM" title="Описание параметра Lim-sell и Lim-buy" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

## **5.2.19. Trading signal shift**

`Trading signal shift` - группа параметров, отвечающих за создание арбитражного канала.

### **5.2.19.1. K**

`К` - коэффициент сдвига заявки, что улучшает цену для каждого последующего входа.  
На параметр `К` будут сдвинуты заявки Lim_Sell в случае продажи или Lim_Buy в случае покупки при наборе позиции. Другими словами, на сколько улучшится положение заявки после удара на вход (ударом считается сделка объемом не меньше v_in_left).

Видео объясняющее работу параметра `К`:

<iframe width="735" height="415" src="https://www.youtube.com/embed/2qUPvspTQq4" title="Описание параметра K" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

### **5.2.19.2. ТР**

`ТР` - уровень противоположной заявки после удара. С помощью параметра `ТР` вы указываете где будет выставлена противоположная заявка после удара (работает только после первого удара).
Если нас ударили по Lim_Sell = 150, то при ТР = 50, Lim_Buy будет выставлен на 150 – 50 = 100.

Видео объясняющее работу параметра `ТР`:

<iframe width="735" height="415" src="https://www.youtube.com/embed/R2nuoUpGq9c" title="Описание параметра TP" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

### **5.2.19.3. K1**

`К1` - коэффициент указывает на сколько будет сдвинута противоположная заявка после второго удара.
`Lim_Buy = 100` из предыдущего примера, при `К1 = 5`, будет установлена на 100 + 5 = 105, после второго удара по `Lim_Sell`.

Видео объясняющее работу параметра `К1`:

<iframe width="735" height="415" src="https://www.youtube.com/embed/nYSPQR2LFhE" title="Описание параметра K1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

### **5.2.19.4. K2**

`К2` - коэффициент сдвига заявки, что улучшает цену заявки каждого последующего выхода.
На параметр `К2` будут сдвинуты заявки `Lim_Sell` или `Lim_Buy` в случае продажи или покупки, соответственно, при выходе из позиции. Другими словами, на сколько улучшится положение следующей заявки на выход после предыдущего удара (ударом считается сделка объемом не меньше `v_out_left`).
Из примера ранее где `Lim_Buy = 105` при `К2 = 3`. При ударе по `Lim_Buy` его значение станет равным 105 - 3 = 102.

Видео объясняющее работу параметра К2:

<iframe width="735" height="415" src="https://www.youtube.com/embed/9RbN893_eD0" title="Описание параметра K2" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

## **5.2.20. Limits timer**

`Limits timer` – время таймера (задается в секундах), таймер включается если торговля включена и проходит сигнал на покупку или продажу, но торговля запрещена из-за того, что робот уже набрал максимальную позицию (по [v_min/v_max](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-11-1-v-min-v-max)).

## **5.2.21. Percent**

`Percent` – процент от `Limits timer` после которого происходит сдвиг. Если сигнал на торговлю продержался указанный процент времени от значения [Limits timer](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-20-limits-timer), то [Lim_sell/Lim_buy]([Lim_sell/Lim_buy](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-18-lim-sell-lim-buy)) передвигаются на [K](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-19-1-k), не смотря на отсутствие сделок по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге.

## **5.2.22. Always timer**

Включенный `Always timer` позволяет всегда использовать `Limits timer`, даже тогда когда можно торговать и происходит выставление заявок.

## **5.2.23. Pos**

Текущая позиция портфеля (в штуках портфелей), вычисляется по формуле:

![Alt text](../00-img/5-2-23.jpg)

где Curpos<sub>first</sub> и Count<sub>first</sub> - это параметры [Curpos](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-6-curpos) и [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count) для инструмента портфеля с взведенным флагом [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first), и округляется вверх или вниз в зависимости от значения параметра [n_perc_fill](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-11-5-n-perc-fill). Изменяется роботом, но может быть отредактирована пользователем вручную.

## **5.2.24. Use timetable**

Использовать торговлю по расписанию, расписание представляет собой список групп параметров:

`Begin` - начало торгового периода.  
`End` - окончание торгового периода.  
`Close` - попытаться закрыть позицию сразу после окончания торгового периода (в течении 10 секунд).  
`To market` - попытаться выровнять позицию сразу после окончания торгового периода (в течении 10 секунд).  
`To0` - использовать [To0](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-26-to0) в данный период.

если текущее локальное время на компьютере (`curTime`) попадает в один из периодов, т.е. `Begini ≤ curTime ≤ Endi`, то `re_sell` и `re_buy` включаются автоматически (кроме режима `Timetable only stop`), в противном случае (если текущее время не попадает ни в один из периодов) `re_sell` и `re_buy` выключаются автоматически.

## **5.2.25. Timetable only stop**

Автоматически выключать торговлю если текущее время не попадает в периоды расписания, но при этом автоматически не включать торговлю если время попадает в один из периодов расписания.

## **5.2.26. To0**

Флаг, если взведен, то не открывать позицию, а только закрывать и не открываться из нулевой позиции.

**Важно:** если установлен флаг [Virt_0_pos](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-11-4-virt-0-pos), то можно получить такое поведение робота, что позиция никогда не попадает ровно в 0, а все время переворачивается то в одну, то в другую сторону.

## **5.2.27. Opened**

Параметр, используемый для подсчета финансового результата, вычисляется по формуле:

![Alt text](../00-img/5-2-27.jpg)

где tradePrice<sub>i</sub> - цена сделки;  
tradeAmount<sub>i</sub> - количество лотов в сделке;  
bought - список сделок на покупку;  
sold - список сделок на продажу;  
Mult<sub>i</sub> - Fin res multiplier инструмента портфеля.

## **5.2.28. Commision sum**

Сумма комиссии по всем сделкам портфеля, используется для подсчёта финансового результата.

## **5.2.29. Decimals**

`Decimals` - параметр, определяющий сколько знаков после десятичной точки отображается в параметрах, значение которых является дробным числом.

## **5.2.31. Custom trade**

Позволяет использовать `Trade formula` для подсчета раздвижки в таблице с финансовыми результатами.

## **5.2.32. Trade formula**

Формула на языке программирования [C++](https://milman-by.github.io/bot-doc/docs/08-c-api.html#_8-c) для подсчета раздвижки в таблице с финансовыми результатами, вы пишете только тело функции и должны вернуть значение типа `double`.

## **5.2.33. Extra formulas**

Флаг, включает расчёт `Extra field#1` и `Extra field#2`.

## **5.2.34. Extra field#1 и Extra field#2**

Поля для дополнительных формул на языке программирования [C++](https://milman-by.github.io/bot-doc/docs/08-c-api.html#_8-c), вы пишете только тело функции и должны вернуть значение типа `double`.

## **5.2.35. Disabled**

Полностью выключить портфель из всех расчетов и торговли, не удаляя его.

**Важно:** при снятии этой галки и восстановлении работы портфеля возможно переоткрытие торговых стаканов и, как следствие, приостановка торговли во всех портфелях, использующих то же дата подключение, на время переоткрытия стаканов.

## **5.2.36. Sell/Buy clicker**

"Кликер", выставить заявку на продажу/покупку заданного количества портфелей. Заявки выставляются сразу по всем инструментам портфеля.

## **5.2.37. To market**

"Кликер", снять все заявки, кроме заявок первой ноги, выставленных по алгоритму, и выставить их по рыночным ценам (с учетом параметра [k_sl](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-13-k-sl)), а так же выровнять позицию заявками по второй ноге (по каждому инструменту второй ноги ставится не более одной выравнивающей заявки).

## **5.2.38. Place order**

Позволяет выставить заявку по одному из инструментов портфеля, не дожидаясь срабатывания настроенных условий портфеля или при выключенной торговле портфеля. Для того, чтобы воспользоваться этой опцией необходимо сделать двойной клик по специальному символу и выбрать необходимые параметры заявки, далее нажать на кнопку `Place order`.  
При включенной торговле выставленная таким образом заявка может привести к срабатыванию параметров:  
`** Hedge (sec)`, `SLE`, `TE`.  
Для удаления выставленной таким способом заявки потребуется биржевой терминал, где вручную снимается заявка или это можно сделать в роботе с помощью кнопки **Hard stop (2.4)

## **5.2.39. Sell/Buy**

`Sell` – расчетная цена на продажу. Нередактируемый параметр.  
`Buy` – расчетная цена на покупку. Нередактируемый параметр.  
Упрощенная формула для двух бумаг:

![Alt text](../00-img/5-2-39-1.jpg)

Формулы расчета `Sell` и `Buy` для любого количества ног:

![Alt text](../00-img/5-2-39-2.jpg)

Наглядно продемонстрирована работа данных параметров в этом видео:

<iframe width="735" height="415" src="https://www.youtube.com/embed/p69X-3l-VLc" title="Описание параметра Sell Buy" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

## **5.2.40. Price_s/Price_b**

`Price_s` – цена выставления заявки на продажу по [Is first 5.3.11](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге, вычисляется как обратная функция для [Sell 5.2.39](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-39-sell-buy), где цена [Sell 5.2.39](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-39-sell-buy) заменяется на [Lim_Sell 5.2.18](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-18-lim-sell-lim-buy). Нередактируемый параметр.  
`Price_b` – цена выставления заявки на покупку по [Is first 5.3.11](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге, вычисляется как обратная функция для [Buy 5.2.39](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-39-sell-buy), где цена [Buy 5.2.39](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-39-sell-buy) заменяется на [Lim_Buy 5.2.18](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-18-lim-sell-lim-buy). Нередактируемый параметр.

Формулы расчета `Price_s` и `Price_b` для двух бумаг:

![Alt text](../00-img/5-2-40-1.jpg)

Формулы расчета `Price_s` и `Price_b` для любого количества ног:

![Alt text](../00-img/5-2-40-2.jpg)

Видео, наглядно объясняющее работу параметров `Price_s/Price_b`:

<iframe width="735" height="415" src="https://www.youtube.com/embed/PKGbweKJbNE" title="Описание параметра Prices" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

## **5.2.41. Sell/Buy status**

Статус заявки на продажу/покупку по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге (не используется при выставлении заявки с помощью "кликеров").  
Для того чтобы освободить "зависшую" заявку, необходимо сделать двойной клик на ячейке таблицы. Ручная смена статуса может привести к потере заявки роботом, данную операцию рекомендуется делать только в крайних случаях.

## **5.2.42. Return first**

Оборот по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге, вычисляется с момента старта серверной части робота как сумма модулей количества лотов в сделках по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) инструменту.

## **5.2.43. Fin res**

Предполагаемый финансовый результат портфеля, вычисляется по формуле:

![Alt text](../00-img/5-2-43.jpg)

где secBid<sub>i</sub> - лучшая цена на покупку инструмента портфеля;  
secOffer<sub>i</sub> - лучшая цена на продажу инструмента портфеля;  
Curpos<sub>i</sub> - текущая позиция инструмента портфеля;  
Mult - [Fin res multiplier](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-21-fin-res-multiplier) инструмента портфеля;  
secs - список инструментов портфеля.

## **5.2.44. Fin res wo C**

`Fin res` без учета комиссии. Вычисляется по формуле:

![Alt text](../00-img/5-2-44.jpg)

где secBid<sub>i</sub> - лучшая цена на покупку инструмента портфеля;  
secOffer<sub>i</sub> - лучшая цена на продажу инструмента портфеля;  
Curpos<sub>i</sub> - текущая позиция инструмента портфеля;  
Mult - [Fin res multiplier](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-21-fin-res-multiplier) инструмента портфеля;  
secs - список инструментов портфеля.
