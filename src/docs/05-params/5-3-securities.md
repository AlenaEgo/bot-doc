# **5.3. Параметры инструментов портфеля**

Далее дано описание параметров инструментов портфеля. Все параметры являются редактируемыми, если прямо не указано иное.

## **5.3.1 SecKey**

Уникальный идентификатор инструмента портфеля. Нередактируемый параметр.

## **5.3.2 SecBoard**

Режим инструмента портфеля. Нередактируемый параметр.

## **5.3.3 SecCode**

Код инструмента портфеля. Нередактируемый параметр.

## **5.3.4 SecType**

Тип инструмента (например, `CURR` для валютного рынка). Нередактируемый параметр.

## **5.3.5 Exchange**

Название биржи, на которой торгуется данная бумага. Нередактируемый параметр.

## **5.3.6. Curpos**

`Curpos` - текущая позиция робота по данной бумаге в лотах.

## **5.3.7 Count type**

`Count type` - использовать [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count) или [Count formula](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-9-count-formula)

## **5.3.8 Count**

`Count` - количество лотов инструмента в одном портфеле.

**Важно:** для многих криптовалютных бирж данный параметр указывается "как бы в сатошах", т.е. чтобы купить/продать 1 лот на бирже необходимо указать количество 100 000 000 (соответственно, 0.1 лота сооветствует значение 10 000 000 и т.д.). При добавлении бумаги в порфтель обращайте внимание на столбец `Price to lot mult`.

**Важно:** если изменяете Count [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаги, не забудьте задать правильные значения для [v_min/v_max](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-11-1-v-min-v-max).

## **5.3.9 Count formula**

`Count formula` - количество лотов инструмента в одном портфеле, задаётся как код на языке программирования C++. Вы пишете только тело функции, и должны вернуть значение типа `double`.

**Важно:** значения [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count)
 или [Count formula](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-9-count-formula) определяют соотношение именно между позициями инструментов портфеля (соотношение в конкретной сделке может отличаться). По этой же причине значение [Count formula](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-9-count-formula) не зависит от направления выставляемой заявки.

**Важно:** настоятельно рекомендуется для [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаги никогда не возвращать значение 0, если вы хотите не торговать, используйте `Ratio formula` и задавайте необходимые значения для раздвижки. Если вы все-таки получили [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count)
 равный 0 для [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаги, то портфель не будет торговать ни одной бумагой и для подсчета позиции портфеля в том месте, где необходимо поделить на [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count)
 [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаги (который в вашем случае равен 0) будет делиться на 1.

## **5.3.10 On buy**

Определяет будем ли мы покупать или продавать инструмент при срабатывании сигнала на покупку по главному инструменту.

## **5.3.11 Is first**

Определяет, является ли бумага главным инструментом портфеля. Позиция портфеля считается по главному инструменту. [On buy](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-10-on-buy) такого инструмента всегда указывается как `Buy`.

## **5.3.12 k**

`k`– задает размер искусственного проскальзывания (отступ от рыночной цены (в пунктах), т.е. при покупке цена выставления `offer + k`, при продаже цена выставления `bid−k`, где `bid` и `offer` – лучшие цены на продажу и покупку, соответственно).

## **5.3.13 k_sl**

`k_sl` - аналог параметра `k`, используется во время перестановок по стоп-лоссу и по таймеру. Задает размер искусственного проскальзывания (отступ от рыночной цены (в пунктах), т.е. для заявки на покупку цена выставления `offer + k_sl`, для заявки на продажу цена выставления `bid−k_sl`, где `bid` и `offer` – лучшие цены на продажу и покупку, соответственно).

## **5.3.14 SLE**

`SLE` – включить/выключить функцию переставления по стоп-лоссу.

## **5.3.15 SL**

`SL` – значение стоп-лосса (в пунктах), при достижении которого необходимо снимать заявку, если она не прошла до этого момента и бросать снова по новой рыночной цене (стоп-лосс откладывается от первоначальной цены выставления заявки);

## **5.3.16 TE**

`TE` - параметр отвечает за включение/выключение функции переставления по таймеру.

## **5.3.17 Timer**

`Timer` - параметр, определяющий через сколько времени снимать заявку, если она не прошла до этого момента и бросать снова по новой рыночной цене.

## **5.3.18. Percent of quantity**

Если на бирже в объеме лучшей цены на продажу или покупку (или в найденном объеме в стакане если [Type price](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-5-type-price) = `Orderbook` или [Type price](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-5-type-price) = `Orderbook + filter`), соответственно, есть нужное количество процентов (%) от объема заявки инструмента, не являющегося [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first), и это условие выполняется для всех не [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) инструментов, то можно выставляться по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) инструменту.

## **5.3.19. Ratio sign**

`Ratio sign` – знак используемый перед коэффициентом [Ratio](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-20-ratio) при расчете цен `Sell` и `Buy`, ”+” или ”×”.

## **5.3.20. Ratio**

`Ratio` – коэффициент, используемый при расчете цен `Sell` и `Buy`.

## **5.3.21. Fin res multiplier**

`Fin res multiplier` - множитель, используется для подсчета финансового результата, чтобы привести все цены к одной размерности.

## **5.3.22. Commission type**

`Commission type` - параметр, определяющий тип расчёта комиссии.

## **5.3.23. Commission**

`Commission` - комиссия по инструменту. Если [Commission type](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-22-commission-type) указан как `%`, то комиссия указывается в процентах от цены сделки, а если как `pt`, то комиссия указывается в той же размерности, в которой считается финансовый результат по портфелю (например, для акции Сбербанка комиссия указывается в процентах и для большинства брокеров она равна 0.01 %, а для фьючерса на акцию Сбербанка комиссия указывается в пунктах и равна 0.25 пункта для скальперских сделок).

## **5.3.24. Client code**

`Client code` - код клиента с которого надо выставлять заявку по данной бумаге или пустая строка если необходимо выставлять с "кода по умолчанию", отображает все коды, которые прописаны в настройках робота, код virtual означает торговлю "в файл" и может быть использован для тестирования стратегий; код, начинающийся с [Round robin](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-24-client-code), означает использование режима выставления заявок [Round robin](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-24-client-code).

**Важно:** Режим [Round robin](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-24-client-code) означает выставление и снятие заявок через все подключения к бирже с заданным клиентским кодом по некоторому алгоритму, при этом поведение этого алгоритма для Московской биржи и для криптобирж различается. Это связано с особенностями торгов и типом подключений на биржах. На криптобиржах при использовании режима Round robin происходит поочередное выставление и снятие заявок через подключения с одинаковым клиентским кодом. Все подключения из списка используются равномерно. Для криптобирж (не всех) это позволяет поднять общую пропускную способность клиентского счёта с помощью использования нескольких подключений с разными парами ключей. На рынках Московской биржи все подключения с одним кодом клиента держатся в очереди, порядок подключений в очереди зависит от скорости выставления заявок через эти подключения (кто в данный момент быстрее, тот первый в очереди, порядок подключений в очереди меняется не чаще раза в секунду, кроме того каждую секунду движение по очереди начинается заново, т.о. загрузка подключений НЕ равномерная). При измерении скорости (Round trip-а) выставления заявок учитывается только скорость некоторых заявок, назовём их важными. Важными заявками считаются заявки, выставленные по первой ноге по алгоритму (т.е не кликером, не стопом и прочими способами), причём только в случае если котирование отключено. Так же важными заявками являются заявки по второй ноге, выставленные по основному алгоритму, т.е. после сделки по первой ноге. Значения round trip'a обнуляются раз в час, чтобы снова была возможность оценить скорость каждого из подключений и выбрать быстрейшее. Таким образом, для Московской биржи выбирается быстрейшее подключение и по возможности заявки выставляются с него.

**Важно:** код клиента не может быть пустым для бумаг с [Count](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-8-count) отличным от нуля.

## **5.3.25. MM**

`MM` - флаг, если взведен, то все заявки по инструменту выставляются с признаком "заявка маркет-мейкера" (работает не для всех подключений).

## **5.3.26. TP**

`TP` - величина тейк-профит, используется при `Type` равном `TP algo` или `TP algo 2`, откладывается от цены сделки по заявке [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) иструмента.

## **5.3.27. Ratio type**

`Ratio type` - использовать значение [Ratio](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-20-ratio) или результат вычисления `Ratio formula` при расчёте значений `Sell` и `Buy`.

## **5.3.28. Ratio buy formula**

Параметр, используемый при расчете цены `Buy`, задается как код на языке программирования [C](https://milman-by.github.io/bot-doc/docs/08-c-api.html#_8-c), вы пишете только тело функции, и должны вернуть значение типа `double`.

## **5.3.29. Ratio sell formula**

Параметр, используемый при расчете цены `Sell`, задается как код на языке программирования [C++](https://milman-by.github.io/bot-doc/docs/08-c-api.html#_8-c), вы пишете только тело функции, и должны вернуть значение типа `double`.

## **5.3.30. FUT move limits**

Флаг, если взведен, то при каждой смене дня будет осуществляться автоматическая подвижка лимитов по формулам:

![Alt text](../00-img/5-3-30.jpg)

где days_to_expiry - целое количество дней до экспирации данной бумаги;  
days_to_expirySPOT - целое количество дней до экспирации бумаги, отмеченной флагом `SPOT move limits` или 1, если такая бумага не указана;  
нижний индекс 0 означает текущее значение параметра;  
нижний индекс 1 означает новое значение параметра.

## **5.3.31. SPOT move limits**

Флаг, если взведен, то данная бумага используется в формулах для FUT move limits`.

## **5.3.32. Depth OB**

`Depth OB` – максимальный уровень глубины стакана до которого включительно вычислять цены и объемы (в штуках шагов цены, считая от бида/оффера), доступен только для не [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first), используется только в режимах [Type price](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-5-type-price) = `Orderbook` и [Type price](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-5-type-price) = `Orderbook + filter`.  
Если у Вас выбран режим [Type price](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-5-type-price) = `Orderbook` и [Type price](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-5-type-price) = `Orderbook + filter`, то необходимо следить за значением `Depth OB`, при слишком низких значениях параметра робот не сможет высчитывать цены и объемы, у вас будут нули в параметрах `Sell` и `Buy`.

## **5.3.33. Calc price OB**

`Calc price OB` – тип цены, используемой для расчета `Sell`, `Buy`, [Price_s](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-40-price-s-price-b), [Price_b](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-40-price-s-price-b), доступен только для не [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаг, используется только в режимах [Type price](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-5-type-price) = `Orderbook` и [Type price](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-5-type-price) = `Orderbook + filter`:

- **Deepest** – цена того уровня в стакане, на котором набрали искомый объем;
- **Weighted avg.** – средневзвешенная цена до того уровня в стакане включительно, на котором набрали искомый объем.

## **5.3.34. Trading price OB**

`Trading price OB` – тип цены, используемой при торговле, доступен только для не [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаг, используется только в режимах [Type price](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-5-type-price) = `Orderbook` и [Type price](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-5-type-price) = `Orderbook + filter`:

- **Deepest** – цена того уровня в стакане, на котором набрали искомый объем;
- **Weighted avg.** – средневзвешенная цена до того уровня в стакане включительно, на котором набрали искомый объем.

_Пример:_  
`Trading price OB - Deepest`:  
Допустим, вы ищете в стакане на покупку 1000 лотов, по цене 100 стоит 500 лотов, потом по цене 99 стоит 490 лотов и по цене 5 стоят оставшиеся 10 лотов. При таком раскладе искомая цена будет равна 5.  
`Trading price OB - Weighted avg.`:  
Из примера выше, `(500 * 100 + 490 * 99 + 5 * 10)/1000 = 98.56` - искомая цена. Перед выставлением заявки робот округлит цену в соответствии с шагом цены данного инструмента. Для продажи выполняется округление вверх, для покупки - округление вниз. Т.е. если шаг цены в данном примере равен 1, то продавать будем по цене 99.

## **5.3.35. Level to0**

`Level to0` - если хотя бы для одной бумаги портфеля модуль разности [Mark price](https://milman-by.github.io/bot-doc/docs/05-params/5-5-positions.html#_5-5-1-5-mark-price) и [Liquidation price](https://milman-by.github.io/bot-doc/docs/05-params/5-5-positions.html#_5-5-1-6-liquidation-price) строго меньше данного значения, то взвести флаг [To0](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-26-to0) и НЕ давать его снять пока условие выполняется, когда условие перестанет выполняться - снять флаг [To0](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-26-to0) (имеет смысл только для бумаг с BitMEX, Deribit, некоторых других).

## **5.3.36. Level close**

`Level close` - если хотя бы для одной бумаги портфеля модуль разности [Mark price](https://milman-by.github.io/bot-doc/docs/05-params/5-5-positions.html#_5-5-1-5-mark-price) и [Liquidation price](https://milman-by.github.io/bot-doc/docs/05-params/5-5-positions.html#_5-5-1-6-liquidation-price) строго меньше данного значения, то взвести флаг [To0](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-26-to0) и НЕ давать его снять пока условие выполняется (когда условие перестанет выполняться - снять флаг [To0](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-26-to0)), раз в 5 секунд выставлять заявку в направлении закрытия позиции в объеме [v_out_left](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-11-3-v-out-left-v-out-right) портфелей до тех пор пока описанное выше условие не перестанет выполняться или позиция по портфелю не станет равно 0 (имеет смысл только для бумаг с BitMEX, Deribit, некоторых других).

## **5.3.37. Only maker**

`Only maker` - выставлять котирующие (т.е. при включенном режиме [Quote](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-6-quote)) заявки по [Is first](https://milman-by.github.io/bot-doc/docs/05-params/5-3-securities.html#_5-3-11-is-first) бумаге с признаком "снять если заявка будет taker" (это параметр заявки, не работает на московской и питерской бирже так как они данный параметр не поддерживают; имеет смысл только для бумаг с BitMEX, Bitfinex, Deribit, некоторых других).

**Важно:** Если вы используете данный параметр, то вероятнее всего вам понадобится взвести флаг [Simply first](https://milman-by.github.io/bot-doc/docs/05-params/5-2-portfolios.html#_5-2-9-simply-first).

## **5.3.38. Leverage**

`Leverage` - параметр определяющий плечо для выставляемой заявки (имеет смысл только для бумаг с HBDM).

## **5.3.39. Decimals**

`Decimals` - параметр, определяющий сколько знаков после десятичной точки отображается в параметрах, для которых значение является дробным числом.

**Важно:** данный параметр так же отвечает за число знаков после десятичной точки в ценах сделок по данной бумаге в таблице раздвижек. При смене значения, число знаков у уже добавленных в таблицу сделок НЕ изменится.

## **5.3.40. Max trans time**

В параметре вы указываете максимально допустимое время Round trip'a (в микросекундах) при котором вы хотите торговать по этой бумаге. Если это время будет превышено, то активируется Ban period.

## **5.3.41. Ban period**

Период, на протяжении которого робот перестает выставлять заявки по первой ноге.
